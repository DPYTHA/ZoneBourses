<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{ opportunity.title }} - ZoneBourse</title>
    <link rel="web icon" href="/static/images/logo1.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery/css/lightgallery-bundle.min.css">
    <style>
        :root {
            --primary-blue: #3B82F6;
            --light-blue: #EFF6FF;
            --dark-blue: #1E40AF;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-900: #111827;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.5;
            min-height: 100vh;
        }
        
        /* Header */
        .mobile-header {
            background: white;
            padding: 0.75rem 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }
        
        .header-back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--gray-700);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .main-content {
            margin-top: 60px;
            padding: 1rem;
        }
        
        /* Opportunity Card */
        .opportunity-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            padding: 1.5rem 1rem;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            color: white;
        }
        
        .opportunity-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .opportunity-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }
        
        /* Meta Grid */
        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }
        
        .meta-icon {
            width: 32px;
            height: 32px;
            background: white;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
        }
        
        /* Content Sections */
        .content-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }
        
        .section-icon {
            color: var(--primary-blue);
            font-size: 1.25rem;
        }
        
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        /* Steps */
        .steps-list {
            list-style: none;
        }
        
        .step-item {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .step-number {
            width: 24px;
            height: 24px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        /* Documents */
        .documents-list {
            list-style: none;
        }
        
        .document-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            margin-bottom: 0.5rem;
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        /* Gallery */
        .gallery-section {
            margin: 1.5rem 0;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .gallery-item {
            aspect-ratio: 4/3;
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        /* Video */
        .video-container {
            margin-top: 1.5rem;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: var(--gray-900);
        }
        
        .video-container iframe {
            width: 100%;
            height: 250px;
            border: none;
        }
        
        /* Contact Info */
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }
        
        /* Buttons */
        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--dark-blue);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 1rem;
        }
        
        /* Related Opportunities */
        .related-section {
            margin-top: 2rem;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .related-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            text-decoration: none;
            color: inherit;
            transition: transform 0.2s;
        }
        
        .related-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* Action Bar */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 900;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1100;
            padding: 1rem;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @media (min-width: 768px) {
            .main-content {
                max-width: 1200px;
                margin: 80px auto 0;
                padding: 2rem;
            }
            
            .action-bar {
                position: static;
                margin-top: 2rem;
                box-shadow: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="mobile-header">
        <a href="{{ url_for('dashboard') }}" class="header-back-btn">
            <i class="fas fa-arrow-left"></i>
            <span>Retour</span>
        </a>
        
        <div style="font-size: 1rem; font-weight: 600; color: var(--gray-900);">
            Opportunité
        </div>
        
        <div style="width: 40px;"></div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Opportunity Card -->
        <div class="opportunity-card">
            <div class="card-header">
                <div class="opportunity-badge">
                    <i class="fas fa-graduation-cap"></i>
                    {% if opportunity.type == 'bourse' %}Bourse d'études
                    {% elif opportunity.type == 'admission' %}Admission
                    {% elif opportunity.type == 'excellence' %}Excellence
                    {% else %}{{ opportunity.type|title }}{% endif %}
                    {% if opportunity.is_featured %}
                        <i class="fas fa-star" style="color: var(--warning);"></i>
                    {% endif %}
                </div>
                
                <h1 class="opportunity-title">{{ opportunity.title }}</h1>
                <p style="opacity: 0.9; font-size: 0.95rem;">
                    {{ opportunity.description[:100] }}...
                </p>
            </div>
            
            <div style="padding: 1.5rem;">
                <!-- Meta Information -->
                <div class="meta-grid">
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; color: var(--gray-600);">Pays</div>
                            <div style="font-size: 0.85rem; font-weight: 600;">{{ opportunity.pays }}</div>
                        </div>
                    </div>
                    
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; color: var(--gray-600);">Montant</div>
                            <div style="font-size: 0.85rem; font-weight: 600;">{{ opportunity.montant }}</div>
                        </div>
                    </div>
                    
                    {% if opportunity.deadline %}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; color: var(--gray-600);">Date limite</div>
                            <div style="font-size: 0.85rem; font-weight: 600;">
                                {{ opportunity.deadline.strftime('%d/%m/%Y') }}
                                {% set days_left = (opportunity.deadline - now.date()).days if opportunity.deadline and now else 0 %}
                                {% if days_left > 0 %}
                                <span style="display: block; font-size: 0.75rem; color: var(--warning);">
                                    ({{ days_left }} jour{{ 's' if days_left > 1 else '' }})
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; color: var(--gray-600);">Publiée</div>
                            <div style="font-size: 0.85rem; font-weight: 600;">
                                {{ opportunity.created_at.strftime('%d/%m/%Y') }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Description -->
                <div class="content-section">
                    <div class="section-header">
                        <i class="fas fa-file-alt section-icon"></i>
                        <h2 class="section-title">Description détaillée</h2>
                    </div>
                    <div style="white-space: pre-line; line-height: 1.6;">
                        {{ opportunity.description }}
                    </div>
                </div>
                
                <!-- Application Steps -->
                {% if steps %}
                <div class="content-section">
                    <div class="section-header">
                        <i class="fas fa-list-ol section-icon"></i>
                        <h2 class="section-title">Processus de postulation</h2>
                    </div>
                    <ol class="steps-list">
                        {% for step in steps %}
                        <li class="step-item">
                            <div class="step-number">{{ loop.index }}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500; margin-bottom: 0.25rem;">
                                    Étape {{ loop.index }}
                                </div>
                                <div style="color: var(--gray-700);">{{ step }}</div>
                            </div>
                        </li>
                        {% endfor %}
                    </ol>
                </div>
                {% endif %}
                
                <!-- Required Documents -->
                {% if documents %}
                <div class="content-section">
                    <div class="section-header">
                        <i class="fas fa-file-upload section-icon"></i>
                        <h2 class="section-title">Documents requis</h2>
                    </div>
                    <ul class="documents-list">
                        {% for document in documents %}
                        <li class="document-item">
                            <i class="fas fa-file-pdf" style="color: var(--primary-blue);"></i>
                            <div style="flex: 1;">
                                <div style="font-weight: 500;">{{ document }}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-600);">
                                    Document obligatoire
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <!-- Gallery -->
                {% if images %}
                <div class="content-section gallery-section">
                    <div class="section-header">
                        <i class="fas fa-images section-icon"></i>
                        <h2 class="section-title">Galerie photos</h2>
                    </div>
                    <div class="gallery-grid" id="gallery">
                        {% for image_url in images %}
                        {% if image_url.strip() %}
                        <a href="{{ image_url.strip() }}" class="gallery-item" data-src="{{ image_url.strip() }}">
                            <img src="{{ image_url.strip() }}" alt="Image {{ loop.index }}" loading="lazy">
                            <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">
                                <i class="fas fa-expand"></i>
                            </div>
                        </a>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Video -->
                {% if opportunity.video_url %}
                <div class="content-section">
                    <div class="section-header">
                        <i class="fas fa-video section-icon"></i>
                        <h2 class="section-title">Vidéo</h2>
                    </div>
                    <div class="video-container">
                        {% if 'youtube.com' in opportunity.video_url or 'youtu.be' in opportunity.video_url %}
                            {% if 'youtube.com/watch?v=' in opportunity.video_url %}
                                {% set video_id = opportunity.video_url.split('v=')[1].split('&')[0] %}
                            {% elif 'youtu.be/' in opportunity.video_url %}
                                {% set video_id = opportunity.video_url.split('youtu.be/')[1] %}
                            {% endif %}
                            <iframe src="https://www.youtube.com/embed/{{ video_id }}" 
                                    allowfullscreen>
                            </iframe>
                        {% elif 'vimeo.com' in opportunity.video_url %}
                            {% set video_id = opportunity.video_url.split('vimeo.com/')[1] %}
                            <iframe src="https://player.vimeo.com/video/{{ video_id }}" 
                                    allowfullscreen>
                            </iframe>
                        {% else %}
                            <div style="padding: 2rem; text-align: center;">
                                <a href="{{ opportunity.video_url }}" target="_blank" class="btn btn-primary">
                                    <i class="fas fa-external-link-alt"></i> Voir la vidéo
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Contact Information -->
                {% if opportunity.contact_email or opportunity.contact_phone %}
                <div class="content-section">
                    <div class="section-header">
                        <i class="fas fa-address-card section-icon"></i>
                        <h2 class="section-title">Contact</h2>
                    </div>
                    <div class="contact-grid">
                        {% if opportunity.contact_email %}
                        <div class="contact-item">
                            <i class="fas fa-envelope" style="color: var(--primary-blue);"></i>
                            <div>
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Email</div>
                                <a href="mailto:{{ opportunity.contact_email }}" style="color: var(--primary-blue); text-decoration: none;">
                                    {{ opportunity.contact_email }}
                                </a>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if opportunity.contact_phone %}
                        <div class="contact-item">
                            <i class="fas fa-phone" style="color: var(--primary-blue);"></i>
                            <div>
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Téléphone</div>
                                <a href="tel:{{ opportunity.contact_phone }}" style="color: var(--primary-blue); text-decoration: none;">
                                    {{ opportunity.contact_phone }}
                                </a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Application Link -->
                {% if opportunity.postulation_link %}
                <div style="margin-top: 2rem;">
                    <a href="{{ opportunity.postulation_link }}" target="_blank" class="btn btn-success btn-block">
                        <i class="fas fa-paper-plane"></i> Postuler maintenant
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Action Bar -->
        <div class="action-bar">
            {% if opportunity.postulation_link %}
            <a href="{{ opportunity.postulation_link }}" target="_blank" class="btn btn-success" style="flex: 1;">
                <i class="fas fa-paper-plane"></i> Postuler
            </a>
            {% endif %}
            
            <button class="btn btn-primary" onclick="shareOpportunity()" style="flex: 1;">
                <i class="fas fa-share-alt"></i> Partager
            </button>
        </div>
        
        <!-- Related Opportunities -->
        {% if related_opportunities %}
        <div class="related-section">
            <div class="section-header">
                <i class="fas fa-th-large section-icon"></i>
                <h2 class="section-title">Opportunités similaires</h2>
            </div>
            <div class="related-grid">
                {% for related in related_opportunities %}
                <a href="{{ url_for('opportunity_details', opportunity_id=related.id) }}" class="related-card">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">{{ related.title }}</div>
                    <div style="font-size: 0.85rem; color: var(--gray-600); margin-bottom: 0.5rem;">
                        {{ related.pays }}
                    </div>
                    <div style="font-size: 0.85rem; color: var(--primary-blue); font-weight: 500;">
                        {{ related.montant }}
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.25rem; font-weight: 600;">
                    <i class="fas fa-share-alt"></i> Partager
                </h3>
                <button onclick="closeModal('shareModal')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-600);">
                    &times;
                </button>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <div style="color: var(--gray-600); margin-bottom: 1rem;">
                    Partagez cette opportunité :
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                    <button onclick="shareWhatsApp()" class="btn" style="background: #25D366; color: white;">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                    <button onclick="shareFacebook()" class="btn" style="background: #1877F2; color: white;">
                        <i class="fab fa-facebook"></i> Facebook
                    </button>
                    <button onclick="copyLink()" class="btn" style="background: var(--gray-700); color: white;">
                        <i class="fas fa-copy"></i> Copier le lien
                    </button>
                    <button onclick="shareEmail()" class="btn" style="background: var(--primary-blue); color: white;">
                        <i class="fas fa-envelope"></i> Email
                    </button>
                </div>
            </div>
            
            <button onclick="closeModal('shareModal')" class="btn" style="width: 100%; background: var(--gray-200); color: var(--gray-700);">
                Annuler
            </button>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery/lightgallery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightgallery/plugins/zoom/lg-zoom.min.js"></script>
    
    <script>
        // Gallery
        if (document.getElementById('gallery')) {
            lightGallery(document.getElementById('gallery'), {
                plugins: [lgZoom, lgThumbnail],
                speed: 500,
                download: false,
                counter: true
            });
        }
        
        // Share functions
        function shareOpportunity() {
            document.getElementById('shareModal').classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function shareWhatsApp() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(`Découvrez cette opportunité : ${document.querySelector('.opportunity-title').textContent}`);
            window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
            closeModal('shareModal');
        }
        
        function shareFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
            closeModal('shareModal');
        }
        
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Lien copié dans le presse-papier !');
                closeModal('shareModal');
            });
        }
        
        function shareEmail() {
            const url = window.location.href;
            const subject = encodeURIComponent(`Opportunité : ${document.querySelector('.opportunity-title').textContent}`);
            const body = encodeURIComponent(`Bonjour,\n\nJe vous partage cette opportunité intéressante :\n\n${url}\n\nCordialement`);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            closeModal('shareModal');
        }
        
        // Close modal on ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal('shareModal');
            }
        });
        
        // Close modal on outside click
        document.getElementById('shareModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('shareModal')) {
                closeModal('shareModal');
            }
        });
    </script>
</body>
</html>